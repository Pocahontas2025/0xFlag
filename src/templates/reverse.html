{% extends "base.html" %}

{% block title %}0xFlag - Reverse Shell{% endblock %}

{% block content %}
<div class="container px-5 my-5">

  <div class="text-center text-white mb-4">
    <h1 class="fw-bolder">Reverse Shell</h1>
    <p class="text-white-50">Generación reactiva de Payloads y Listeners</p>
  </div>

  <div class="row justify-content-center">
    <div class="col-lg-8">

      <div class="card bg-secondary text-white border-0 shadow mb-4">
        <div class="card-body p-4">
          
          <label class="fw-bold mb-2 d-block">Tipo de shell</label>
          <div class="row g-3 mb-4">
            
            <div class="col-md-4">
              <label class="card shell-card active h-100">
                <input type="radio" name="shell_type" value="bash" checked>
                <div class="card-body text-center p-3">
                  <div class="fw-bold"><i class="bi bi-terminal-fill"></i> Bash</div>
                  <small class="text-white-50">/bin/bash</small>
                </div>
              </label>
            </div>

            <div class="col-md-4">
              <label class="card shell-card h-100">
                <input type="radio" name="shell_type" value="php">
                <div class="card-body text-center p-3">
                  <div class="fw-bold"><i class="bi bi-filetype-php"></i> PHP</div>
                  <small class="text-white-50">cmd / web</small>
                </div>
              </label>
            </div>

            <div class="col-md-4">
              <label class="card shell-card h-100">
                <input type="radio" name="shell_type" value="nc">
                <div class="card-body text-center p-3">
                  <div class="fw-bold"><i class="bi bi-hdd-network"></i> Netcat</div>
                  <small class="text-white-50">mkfifo</small>
                </div>
              </label>
            </div>

          </div>

          <div class="row">
            <div class="col-md-7 mb-3">
              <label class="fw-bold">LHOST (Tu IP)</label>
              <input
                id="lhost"
                type="text"
                class="form-control bg-dark text-white border-0"
                placeholder="Ej: 10.10.14.5"
                value="{{ config.attacker_ip if config and config.attacker_ip else '' }}"
              >
            </div>

            <div class="col-md-5 mb-3">
              <label class="fw-bold">LPORT</label>
              <input
                id="lport"
                type="number"
                class="form-control bg-dark text-white border-0"
                placeholder="4444"
                value="4444"
              >
            </div>
          </div>

          <div class="form-check mt-2">
            <input class="form-check-input" type="checkbox" id="urlencode">
            <label class="form-check-label text-white-50" for="urlencode">
              Aplicar URL Encode (para navegadores/curl)
            </label>
          </div>

        </div>
      </div>

      <div class="terminal-output mb-4">
          <div class="output-header">
              <span class="fw-bold">&gt; Payload:</span>
              <button class="btn-copy" type="button" data-target="output">
                  <i class="bi bi-clipboard"></i> Copiar
              </button>
          </div>

          <div id="output" class="terminal-input text-break" style="height: auto;">
              Esperando datos...
          </div>

      </div>

      <div class="terminal-output">
          <div class="output-header">
              <span class="fw-bold">&gt; Listener:</span>
              <button class="btn-copy" type="button" data-target="listener">
                  <i class="bi bi-clipboard"></i> Copiar
              </button>
          </div>
          <div id="listener" class="terminal-input text-break" style="height: auto;">
            nc -lvnp 4444
          </div>
      </div>

    </div>
  </div>
</div>



<script>
document.addEventListener("DOMContentLoaded", function () {
  const lhost = document.getElementById("lhost");
  const lport = document.getElementById("lport");
  const output = document.getElementById("output");
  const listener = document.getElementById("listener");
  const urlencode = document.getElementById("urlencode");
  const shells = document.querySelectorAll('input[name="shell_type"]');

  if (!lhost || !lport || !output || !urlencode) return;

  function generate() {
    if (!lhost.value || !lport.value) {
      output.textContent = "Esperando datos...";
      return;
    }

    const shell = document.querySelector('input[name="shell_type"]:checked')?.value;

    let payload = "";


    switch (shell) {
      case "bash":
        payload = `COMMAND bash connect ${lhost.value} ${lport.value}`;
        break;
      case "php":
        payload = `COMMAND php connect ${lhost.value} ${lport.value}`;
        break;
      case "nc":
        payload = `COMMAND nc connect ${lhost.value} ${lport.value}`;
        break;
      default:
        payload = "Esperando selección...";
    }

    output.textContent = urlencode.checked
      ? encodeURIComponent(payload)
      : payload;

    listener.textContent = `listener ${lport.value}`;
  }

  lhost.addEventListener("input", generate);
  lport.addEventListener("input", generate);
  urlencode.addEventListener("change", generate);
  shells.forEach(r => r.addEventListener("change", generate));

  // Inicial
  generate();
});
</script>




{% endblock %}