{% extends "base.html" %}

{% block title %}0xFlag - TTY Assist{% endblock %}

{% block extra_css %}
<style>
body {
    background-color: #000;
}

.terminal-output {
    background-color: #000;
    color: #00ff00;
    font-family: 'Courier New', Courier, monospace;
    padding: 15px;
    border-radius: 5px;
    border: 1px solid #00ff00;
    margin-top: 20px;
}

.output-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-right: 4px;
}

#btn-copiar {
    background-color: #00ff00;
    color: #000;
    border: none;
    padding: 4px 8px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
    transition: background-color 0.2s ease;
}

#btn-copiar:hover {
    background-color: #00cc00;
}

#btn-copiar.copiado {
    background-color: #00ccff;
}
</style>
{% endblock %}

{% block content %}
<div class="container px-5 my-5">
    <div class="text-center text-white mb-5">
        <h1 class="fw-bolder">TTY Assistant</h1>
        <p class="lead text-white-50">Estabiliza tu TTY</p>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-6">
            <div class="card bg-secondary text-white border-0 shadow">
                <div class="card-body p-4">
<form method="POST">

    <div class="mb-3">
        <label class="form-label fw-bold">Select TTY stabilization method:</label>
        <select class="form-select" name="procedure" required>
            <option value="">-- Selecciona un metodo --</option>
            {% for key, proc in procedures.items() %}
                <option value="{{ key }}" {% if selected == key %}selected{% endif %}>
                    {{ proc.name }} — {{ proc.description }}
                </option>
            {% endfor %}
        </select>
    </div>

    <div class="d-grid">
        <button type="submit" class="btn btn-success btn-lg">
            SHOW STEPS
        </button>
    </div>

</form>


                </div>
            </div>

            {% if procedure %}
<div class="terminal-output">
    <div class="output-header">
        <h5 class="mb-0">&gt; {{ procedure.name }}</h5>
        <button id="btn-copiar">
            <i class="bi bi-clipboard"></i> Copiar
        </button>
    </div>

    <hr class="border-success mt-1 mb-2">

    <pre id="output-text" class="mb-0">
{% for cmd in procedure.commands %}
{{ loop.index }}. {{ cmd }}
{% endfor %}
    </pre>

    {% if procedure.notes %}
    <div class="mt-2 text-warning small">
        ⚠ {{ procedure.notes }}
    </div>
    {% endif %}
</div>
{% endif %}

        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", () => {
    const btn = document.getElementById("btn-copiar");
    const output = document.getElementById("output-text");

    if (!btn || !output) return;

    btn.addEventListener("click", () => {
        const textToCopy = output.innerText;

        // Fallback copy for HTTP/non-HTTPS
        const textArea = document.createElement("textarea");
        textArea.value = textToCopy;
        textArea.style.position = "fixed";
        textArea.style.top = "-9999px";
        textArea.style.left = "-9999px";
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();

        try {
            document.execCommand("copy");
        } catch (err) {
            alert("No se pudo copiar al portapapeles. Copia manualmente.");
        }

        document.body.removeChild(textArea);

        btn.classList.add("copiado");
        btn.innerHTML = '<i class="bi bi-check-lg"></i> Copiado';
        setTimeout(() => {
            btn.classList.remove("copiado");
            btn.innerHTML = '<i class="bi bi-clipboard"></i> Copiar';
        }, 1500);
    });
});
</script>
{% endblock %}
