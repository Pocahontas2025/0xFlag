{% extends "base.html" %}

{% block title %}0xFlag - Discovery{% endblock %}

{% block extra_css %}
<style>
    .terminal-output {
        background-color: #0000;
        color: #00ff00;
        font-family: 'Courier New', Courier, monospace;
        padding: 15px;
        border-radius: 5px;
        border: 1px solid #00ff00;
        margin-top: 20px;
    }

    .output-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-right: 4px;
    }

    #btn-copiar {
        background-color: #00ff00;
        color: #000;
        border: none;
        padding: 4px 8px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.2s ease;
    }

    #btn-copiar:hover {
        background-color: #00cc00;
    }

    #btn-copiar.copiado {
        background-color: #00ccff;
    }
</style>
{% endblock %}


{% block content %}
<div class="container px-5 my-5">
  <div class="text-center text-white mb-5">
    <h1 class="fw-bolder">Discovery (Directorios)</h1>
    <p class="lead text-white-50">
      Generaci√≥n de comandos para descubrimiento de directorios
    </p>
  </div>

  <div class="row justify-content-center">
    <div class="col-lg-7">

      <div class="card bg-secondary text-white border-0 shadow">
        <div class="card-body p-4">

          <form action="/generate_discovery" method="POST">

            <!-- URL -->
            <div class="mb-3">
              <label class="form-label fw-bold">URL objetivo</label>
              <input
                type="text"
                class="form-control"
                name="target_url"
                required
                value="{{ current.target_url if current else '' }}"
                placeholder="http://10.10.10.55 o 10.10.10.55">
              <div class="form-text text-white-50">
                Si no se indica esquema, se asume http://
              </div>
            </div>

            <!-- Wordlist -->
            <div class="mb-3">
              <label class="form-label fw-bold">Diccionario (wordlist)</label>
              <input
                type="text"
                class="form-control"
                name="wordlist"
                required
                value="{{ current.wordlist if current else '' }}"
                placeholder="/usr/share/wordlists/dirb/common.txt">
            </div>

            <!-- Extensiones -->
            <div class="mb-3">
              <label class="form-label fw-bold">Extensiones (opcional)</label>
              <input
                type="text"
                class="form-control"
                name="extensions"
                value="{{ current.extensions if current else '' }}"
                placeholder=".php, .txt, .bak">
              <div class="form-text text-white-50">
                Separadas por comas. Con o sin punto.
              </div>
            </div>

            <!-- Tool -->
            <div class="mb-3">
              <label class="form-label fw-bold">Herramienta</label>
              <select class="form-select" name="tool">
                <option value="gobuster" {% if current and current.tool=='gobuster' %}selected{% endif %}>gobuster</option>
                <option value="ffuf" {% if current and current.tool=='ffuf' %}selected{% endif %}>ffuf</option>
                <option value="dirsearch" {% if current and current.tool=='dirsearch' %}selected{% endif %}>dirsearch</option>
              </select>
            </div>

            <div class="d-grid mt-4">
              <button type="submit" class="btn btn-success btn-lg">
                GENERAR COMANDO
              </button>
            </div>

          </form>
        </div>
      </div>

      {% if message %}
        <div class="alert alert-info mt-3">
          {{ message }}
        </div>
      {% endif %}

      {% if command %}
        <div class="terminal-output">
            <div class="output-header">
                <h5 class="mb-0">&gt; Output:</h5>
                <button id="btn-copiar" type="button">
                    <i class="bi bi-clipboard"></i> Copiar
                </button>
            </div>

            <hr class="border-success mt-1 mb-2">
            <p id="output-text" class="mb-0">{{ command }}</p>
        </div>
        {% endif %}


    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", () => {
    const btn = document.getElementById("btn-copiar");
    const output = document.getElementById("output-text");

    if (!btn || !output) return;

    btn.addEventListener("click", () => {
        const textToCopy = output.innerText;

        // Fallback for all browsers/sites
        const textArea = document.createElement("textarea");
        textArea.value = textToCopy;
        // Avoid scrolling to bottom
        textArea.style.position = "fixed";
        textArea.style.top = "-9999px";
        textArea.style.left = "-9999px";
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();

        try {
            const successful = document.execCommand("copy");
            if (!successful) throw new Error("Copy command failed");
        } catch (err) {
            alert("No se pudo copiar al portapapeles. Copia manualmente.");
        }

        document.body.removeChild(textArea);

        // Show visual feedback
        btn.classList.add("copiado");
        btn.innerHTML = '<i class="bi bi-check-lg"></i> Copiado';
        setTimeout(() => {
            btn.classList.remove("copiado");
            btn.innerHTML = '<i class="bi bi-clipboard"></i> Copiar';
        }, 1500);
    });
});
</script>

{% endblock %}
